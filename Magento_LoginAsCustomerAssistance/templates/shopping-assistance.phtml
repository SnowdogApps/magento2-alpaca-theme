<?php
use Magento\Framework\Escaper;
use Magento\LoginAsCustomerAssistance\Api\IsAssistanceEnabledInterface;
use Magento\LoginAsCustomerAssistance\ViewModel\ShoppingAssistanceViewModel;

/** @var Escaper $escaper */
/** @var ShoppingAssistanceViewModel $viewModel */
$viewModel = $block->getViewModel();
?>

<?php if ($viewModel->isLoginAsCustomerEnabled()): ?>
    <script type="text/x-magento-init">
    {
        ".form-create-account, .form-edit-account": {
            "Magento_LoginAsCustomerAssistance/js/opt-in": {
                "allowAccess": "<?= /* @noEscape */ IsAssistanceEnabledInterface::ALLOWED ?>",
                "denyAccess": "<?= /* @noEscape */ IsAssistanceEnabledInterface::DENIED ?>"
            }
        }
    }
    </script>

    <div
        class="
            field
            choice
            margin-bottom-l
        "
    >
        <div class="checkbox">
            <input
                type="checkbox"
                name="assistance_allowed"
                title="<?= $escaper->escapeHtmlAttr(__($viewModel->getAssistanceCheckboxTitle())) ?>"
                value="2"
                id="assistance_allowed"
                <?php if ($viewModel->isAssistanceAllowed()): ?>
                    checked="checked"
                <?php endif; ?>
                class="checkbox__field"
            />
            <svg
                class="
                    checkbox__icon
                    checkbox__icon--checked
                "
                role="presentation"
                focusable="false"
            >
                <use href="<?= $block->escapeUrl($block->getViewFileUrl('images/icons-sprite.svg#checked')) ?>"></use>
            </svg>
            <svg
                class="
                    checkbox__icon
                    checkbox__icon--unchecked
                "
                role="presentation"
                focusable="false"
            >
                <use href="<?= $block->escapeUrl($block->getViewFileUrl('images/icons-sprite.svg#unchecked')) ?>"></use>
            </svg>
            <label
                for="assistance_allowed"
                class="checkbox__label"
            >
                <?= $escaper->escapeHtmlAttr(__($viewModel->getAssistanceCheckboxTitle())) ?>
            </label>
        </div>
        <span>
            <?= $escaper->escapeHtmlAttr(__($viewModel->getAssistanceCheckboxTooltip())) ?>
        </span>
    </div>
<?php endif ?>
