<?php
// @codingStandardsIgnoreFile

/** @var \Magento\Customer\Block\Form\Edit $block */
?>
<div class="users-account">
    <h2>
        <?php /* @escapeNotVerified */ echo __('Account Information') ?>
    </h2>
    <form action="<?php /* @escapeNotVerified */ echo $block->getUrl('customer/account/editPost') ?>"
          method="post" id="form-validate"
          enctype="multipart/form-data"
          data-hasrequired="<?php /* @escapeNotVerified */ echo __('* Required Fields') ?>"
          autocomplete="off"
          class="form form-edit-account"
          aria-labelledby="form-label"
    >
        <h3 id="form-label" class="heading heading--fifth-level">
            <?php /* @escapeNotVerified */ echo __('Edit Account Information') ?>
        </h3>
        <fieldset class="fieldset info users-account__fieldset"
                  aria-labelledby="personal-info"
        >
            <h4 id="personal-info"
                class="heading heading--sixth-level"
            >
                <?php /* @escapeNotVerified */ echo __('Personal informations'); ?>
            </h4>
            <?php echo $block->getBlockHtml('formkey')?>

            <?php echo $block->getLayout()->createBlock('Magento\Customer\Block\Widget\Name')->setObject($block->getCustomer())->toHtml() ?>

            <?php $_dob = $block->getLayout()->createBlock('Magento\Customer\Block\Widget\Dob') ?>
            <?php $_taxvat = $block->getLayout()->createBlock('Magento\Customer\Block\Widget\Taxvat') ?>
            <?php $_gender = $block->getLayout()->createBlock('Magento\Customer\Block\Widget\Gender') ?>
            <?php if ($_dob->isEnabled()): ?>
                <?php echo $_dob->setDate($block->getCustomer()->getDob())->setHtmlClass('input__field')->toHtml() ?>
            <?php endif ?>
            <?php if ($_taxvat->isEnabled()): ?>
                <?php echo $_taxvat->setTaxvat($block->getCustomer()->getTaxvat())->toHtml() ?>
            <?php endif ?>
            <?php if ($_gender->isEnabled()): ?>
                <?php echo $_gender->setGender($block->getCustomer()->getGender())->toHtml() ?>
            <?php endif ?>
            <div class="field choice checkbox">
                <input id="change-email"
                       type="checkbox"
                       name="change_email"
                       data-role="change-email"
                       value="1"
                       title="<?php /* @escapeNotVerified */ echo __('Change Email'); ?>"
                       class="checkbox checkbox__field"
                />
                <svg class="checkbox__icon">
                    <use xlink:href="<?= $block->getViewFileUrl('images/icons-sprite.svg#checked'); ?>"></use>
                </svg>
                <label for="change-email"
                       class="label checkbox__label"
                >
                    <?php /* @escapeNotVerified */ echo __('Change Email'); ?>
                </label>
            </div>
            <div class="field choice checkbox">
                <input id="change-password"
                       type="checkbox"
                       name="change_password"
                       data-role="change-password"
                       value="1"
                       title="<?php /* @escapeNotVerified */ echo __('Change Password'); ?>"
                       <?php if ($block->getChangePassword()): ?>
                           checked="checked"
                       <?php endif; ?>
                       class="checkbox checkbox__field"
                />
                <svg class="checkbox__icon">
                    <use xlink:href="<?= $block->getViewFileUrl('images/icons-sprite.svg#checked'); ?>"></use>
                </svg>
                <label for="change-password"
                       class="label checkbox__label"
                >
                    <?php /* @escapeNotVerified */ echo __('Change Password'); ?>
                </label>
            </div>
        </fieldset>

        <fieldset class="fieldset password"
                  data-container="change-email-password"
                  aria-labelledby="change-info-fieldset"
        >
            <h4 id="change-info-fieldset"
                class="heading heading--sixth-level"
                data-title="change-email-password"
            >
                <?php /* @escapeNotVerified */ echo __('Change Email and Password'); ?>
            </h4>

            <div class="form__field email required input"
                 data-container="change-email"
            >
                <label class="label input__label" for="email">
                    <?php /* @escapeNotVerified */ echo __('Email'); ?>
                </label>
                <input id="email"
                       type="email"
                       name="email"
                       autocomplete="email"
                       data-input="change-email"
                       value="<?php echo $block->escapeHtml($block->getCustomer()->getEmail()); ?>"
                       title="<?php /* @escapeNotVerified */ echo __('Email'); ?>"
                       class="input__field"
                       data-validate="{required:true, 'validate-email':true}"
                 />
            </div>
            <div class="form__field password current required input">
                <label for="current-password"
                       class="label input__label"
                >
                    <?php /* @escapeNotVerified */ echo __('Current Password'); ?>
                </label>
                <input id="current-password"
                       type="password"
                       class="input__field"
                       name="current_password"
                       data-input="current-password"
                       autocomplete="off"
                />
            </div>
            <div class="form__field new password required input"
                 data-container="new-password"
                 data-mage-init='{"passwordStrengthIndicator": {}}'
            >
                <label for="password"
                       class="label input__label"
                >
                    <?php /* @escapeNotVerified */ echo __('New Password'); ?>
                </label>
                <input id="password"
                       type="password"
                       class="input__field"
                       name="password"
                       data-password-min-length="<?php echo $block->escapeHtml($block->getMinimumPasswordLength()); ?>"
                       data-password-min-character-sets="<?php echo $block->escapeHtml($block->getRequiredCharacterClassesNumber()); ?>"
                       data-input="new-password"
                       data-validate="{required:true, 'validate-customer-password':true}"
                       autocomplete="off"
                />
                <div id="password-strength-meter-container"
                     data-role="password-strength-meter"
                     class="password-field-strength"
                >
                    <div id="password-strength-meter"
                         class="password-strength-meter"
                    >
                        <?php /* @escapeNotVerified */ echo __('Password Strength'); ?>:
                        <span id="password-strength-meter-label"
                              data-role="password-strength-meter-label"
                              class="password-strength-meter__strength-measure"
                        >
                            <?php /* @escapeNotVerified */ echo __('No Password'); ?>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form__field confirm password required input"
                 data-container="confirm-password"
            >
                <label for="password-confirmation"
                       class="label"
                >
                    <?php /* @escapeNotVerified */ echo __('Confirm New Password'); ?>
                </label>
                <input id="password-confirmation"
                       type="password"
                       class="input__field"
                       name="password_confirmation"
                       data-input="confirm-password"
                       autocomplete="off"
                 />
            </div>
            <?php echo $block->getChildHtml('form_additional_info'); ?>
        </fieldset>
        <div class="users-account__actions actions-toolbar">
            <a href="<?php echo $block->escapeUrl($block->getBackUrl()); ?>"
               class="action back users-account__button"
            >
                <?php /* @escapeNotVerified */ echo __('Go back'); ?>
            </a>
            <button type="submit"
                    class="action save primary users-account__button-primary"
                    title="<?php /* @escapeNotVerified */ echo __('Save'); ?>"
                    aria-label="<?php /* @escapeNotVerified */ echo __('Save button'); ?>"
            >
                    <?php /* @escapeNotVerified */ echo __('Save'); ?>
            </button>
        </div>
    </form>
</div>

<script>
    require([
        "jquery",
        "mage/mage"
    ], function($){
        var dataForm = $('#form-validate');
        var ignore = <?php /* @escapeNotVerified */ echo $_dob->isEnabled() ? '\'input[id$="full"]\'' : 'null'; ?>;

        dataForm.mage('validation', {
        <?php if ($_dob->isEnabled()): ?>
            errorPlacement: function(error, element) {
                if (element.prop('id').search('full') !== -1) {
                    var dobElement = $(element).parents('.customer-dob'),
                        errorClass = error.prop('class');
                    error.insertAfter(element.parent());
                    dobElement.find('.validate-custom').addClass(errorClass)
                        .after('<div class="' + errorClass + '"></div>');
                }
                else {
                    error.insertAfter(element);
                }
            },
            ignore: ':hidden:not(' + ignore + ')'
        <?php else: ?>
            ignore: ignore ? ':hidden:not(' + ignore + ')' : ':hidden'
        <?php endif ?>
        });

    });
</script>
<script type="text/x-magento-init">
    {
        "[data-role=change-email], [data-role=change-password]": {
            "changeEmailPassword": {
                "titleChangeEmail": "<?php /* @escapeNotVerified */ echo __('Change Email') ?>",
                "titleChangePassword": "<?php /* @escapeNotVerified */ echo __('Change Password') ?>",
                "titleChangeEmailAndPassword": "<?php /* @escapeNotVerified */ echo __('Change Email and Password') ?>"
            }
        }
    }

</script>
