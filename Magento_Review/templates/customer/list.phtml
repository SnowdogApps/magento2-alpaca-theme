<?php
/**
 * @var \Magento\Review\Block\Customer\ListCustomer $block
 * @var \Magento\Framework\Escaper $escaper
 * @var \Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer
 */

/** @var \Magento\Review\Helper\Data $reviewHelper */
$reviewHelper = $block->getData('reviewHelper');
?>
<?php if ($block->getReviews() && count($block->getReviews())): ?>
    <div class="dashboard-table">
        <div class="dashboard-table__header">
            <h3 class="dashboard-table__title">
                <?= __('Product Reviews') ?>
            </h3>
        </div>

        <div class="dashboard-table__content">
            <table
                class="table dashboard-table__table"
                id="my-reviews-table"
            >
                <thead>
                    <tr>
                        <th scope="col" class="col date">
                            <?= __('Created') ?>
                        </th>

                        <th scope="col" class="col item">
                            <?= __('Product Name') ?>
                        </th>

                        <th scope="col" class="col summary">
                            <?= __('Rating') ?>
                        </th>

                        <th scope="col" class="col description">
                            <?= __('Review') ?>
                        </th>

                        <th scope="col" class="col actions">
                            &nbsp;
                        </th>
                    </tr>
                </thead>

                <tbody>
                    <?php foreach ($block->getReviews() as $review): ?>
                        <tr>
                            <td
                                data-th="<?= $escaper->escapeHtmlAttr(__('Created')) ?>"
                                class="col date"
                            >
                                <?= $escaper->escapeHtml($block->dateFormat($review->getReviewCreatedAt())) ?>
                            </td>

                            <td
                                data-th="<?= $escaper->escapeHtmlAttr(__('Product Name')) ?>"
                                class="col item"
                            >
                                <strong class="product-name">
                                    <a
                                        href="<?= $escaper->escapeUrl($block->getProductUrl($review)) ?>"
                                        class="link"
                                    >
                                        <?= $escaper->escapeHtml($review->getName()) ?>
                                    </a>
                                </strong>
                            </td>

                            <td data-th="<?= $escaper->escapeHtmlAttr(__('Rating')) ?>"
                                class="col summary"
                            >
                                <?php if ($review->getSum()): ?>
                                    <?php $getPercentRating = ((int)$review->getSum() / (int)$review->getCount()) . '%'; ?>

                                    <div class="rating__summary">
                                        <span
                                            class="rating__fill"
                                            style="width:<?= $block->escapeHtmlAttr($getPercentRating); ?>;"
                                        >
                                            <span>
                                                <?= $getPercentRating; ?>
                                            </span>
                                        </span>
                                    </div>
                                <?php endif; ?>
                            </td>

                            <td
                                data-th="<?= $escaper->escapeHtmlAttr(__('Review')) ?>"
                                class="col description"
                            >
                                <?= $reviewHelper->getDetailHtml($review->getDetail()) ?>
                            </td>

                            <td
                                data-th="<?= $escaper->escapeHtmlAttr(__('Actions')) ?>"
                                class="col actions"
                            >
                                <a
                                    href="<?= $escaper->escapeUrl($block->getReviewUrl($review)) ?>"
                                    class="link more"
                                >
                                    <?= $escaper->escapeHtml(__('See Details')) ?>
                                </a>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>

    <?php if ($block->getToolbarHtml()): ?>
        <?= /* @escapeNotVerified */$block->getToolbarHtml() ?>
    <?php endif; ?>
<?php else: ?>
    <div class="message info empty">
        <?= __('You have submitted no reviews.') ?>
    </div>
<?php endif; ?>

<div class="action">
    <div class="action__handler">
        <a
            class="
                link
                action__link
                back
            "
            href="<?= $escaper->escapeUrl($block->getBackUrl()) ?>"
        >
            <?= __('Back') ?>
        </a>
    </div>
</div>
