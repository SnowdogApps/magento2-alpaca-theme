<?php
// phpcs:disable Magento2.Templates.ThisInTemplate.FoundThis
// phpcs:disable PSR2.ControlStructures.SwitchDeclaration
// phpcs:disable Generic.WhiteSpace.ScopeIndent

/* @var $block \Magento\Catalog\Block\Product\Compare\ListCompare */
?>
<?php $_total = $block->getItems()->getSize() ?>
<?php if ($_total): ?>
    <div class="container">
        <div class="compare">
            <table
                class="compare__table"
                id="product-comparison"
                data-mage-init='{
                    "compareList": {
                        "windowPrintSelector": ".action.print",
                        "productsInRow": "5",
                        "selectors": {
                            "productAddToCartSelector": "button.action.tocart"
                        }
                    }
                }'
            >
                <thead>
                    <tr>
                        <?php $_i = 0; ?>
                        <?php $_helper = $this->helper('Magento\Catalog\Helper\Output'); ?>
                        <?php /** @var $_item \Magento\Catalog\Model\Product */ ?>
                        <?php foreach ($block->getItems() as $_item): ?>
                            <?php if ($_i++ === 0): ?>
                                <th
                                    scope="row"
                                    class="compare__label"
                                >
                                    <?= $escaper->escapeHtml(__('Product')) ?>
                                </th>
                            <?php endif; ?>
                            <td
                                data-th="<?= $escaper->escapeHtmlAttr(__('Product')) ?>"
                                class="compare__cell"
                            >
                                <div class="compare__product">
                                    <a
                                        class="compare__link"
                                        href="<?= $escaper->escapeUrl($block->getProductUrl($_item)) ?>"
                                        title="<?= /* @noEscape */ $block->stripTags($_item->getName(), null, true) ?>"
                                    >
                                        <?= $block->getImage($_item, 'product_comparison_list')->toHtml() ?>
                                    </a>
                                    <a
                                        class="compare__link"
                                        href="<?= $escaper->escapeUrl($block->getProductUrl($_item)) ?>"
                                        title="<?= $block->stripTags($_item->getName(), null, true) ?>"
                                    >
                                        <?= /* @noEscape */ $_helper->productAttribute($_item, $_item->getName(), 'name') ?>
                                    </a>
                                    <?php
                                    $rating = $block->getReviewsSummaryHtml($_item, 'short');
                                    if (trim($rating)): ?>
                                        <div class="rating compare__rating">
                                            <?= $rating ?>
                                        </div>
                                    <?php endif ?>
                                    <?= /* @noEscape */ $block->getProductPrice($_item) ?>
                                    <div class="compare__buttons-container">
                                        <?php if ($_item->isSaleable()): ?>
                                            <form
                                                class="compare__form"
                                                data-role="tocart-form"
                                                action="<?= $escaper->escapeUrl($this->helper('Magento\Catalog\Helper\Product\Compare')->getAddToCartUrl($_item)) ?>"
                                                method="post"
                                            >
                                                <?= $block->getBlockHtml('formkey') ?>
                                                <button
                                                    type="submit"
                                                    class="
                                                        action
                                                        tocart
                                                        button
                                                        button--secondary
                                                        compare__cart
                                                    "
                                                    title="<?= $escaper->escapeHtmlAttr(__('Add to Cart')) ?>"
                                                    aria-label="<?= $escaper->escapeHtmlAttr(__('Add to Cart')) ?>"
                                                    disabled
                                                >
                                                    <span class="compare__cart-text">
                                                        <?= $escaper->escapeHtml(__('Add to Cart')) ?>
                                                    </span>
                                                    <svg class="icon compare__cart-icon">
                                                        <use href="<?= $escaper->escapeUrl($block->getViewFileUrl('/images/icons-sprite.svg#shopping-cart')) ?>"></use>
                                                    </svg>
                                                </button>
                                            </form>
                                        <?php else: ?>
                                            <?php if ($_item->isAvailable()): ?>
                                                <?= $escaper->escapeHtml(__('In stock')) ?>
                                            <?php else: ?>
                                                <?= $escaper->escapeHtml(__('Out of stock')) ?>
                                            <?php endif; ?>
                                        <?php endif; ?>
                                        <div class="compare__secondary-buttons">
                                            <?php if ($this->helper('Magento\Wishlist\Helper\Data')->isAllow()) : ?>
                                                <div data-role="add-to-links">
                                                    <button
                                                        class="action towishlist button button--icon compare__wishlist"
                                                        type="button"
                                                        data-post='<?= /* @noEscape */ $block->getAddToWishlistParams($_item) ?>'
                                                        data-action="add-to-wishlist"
                                                        title="<?= $escaper->escapeHtmlAttr(__('Add to Wish List')) ?>"
                                                        aria-label="<?= $escaper->escapeHtmlAttr(__('Add to Wish List')) ?>"
                                                    >
                                                        <svg class="button__icon compare__wishlist-icon">
                                                            <use href="<?= $escaper->escapeUrl($block->getViewFileUrl('/images/icons-sprite.svg#heart')) ?>"></use>
                                                        </svg>
                                                    </button>
                                                </div>
                                            <?php endif; ?>
                                            <?php $compareHelper = $this->helper('Magento\Catalog\Helper\Product\Compare');?>
                                            <button
                                                type="button"
                                                data-post='<?= /* @noEscape */ $compareHelper->getPostDataRemove($_item) ?>'
                                                class="action delete button button--icon compare__remove"
                                                title="<?= $escaper->escapeHtmlAttr(__('Remove from Compare')) ?>"
                                                aria-label="<?= $escaper->escapeHtmlAttr(__('Remove from Compare')) ?>"
                                            >
                                                <svg class="button__icon compare__remove-icon">
                                                    <use href="<?= $escaper->escapeUrl($block->getViewFileUrl('/images/icons-sprite.svg#remove')) ?>"></use>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        <?php endforeach; ?>
                    </tr>
                </thead>

                <tbody>
                    <?php foreach ($block->getAttributes() as $_attribute): ?>
                        <?php $index = 0; ?>
                        <?php if ($block->hasAttributeValueForProducts($attribute)) :?>
                            <tr>
                                <?php $index = 0 ?>
                                <?php foreach ($block->getItems() as $_item): ?>
                                    <?php if ($index++ === 0): ?>
                                        <th
                                            scope="row"
                                            class="compare__label"
                                        >
                                            <?= $escaper->escapeHtml($_attribute->getStoreLabel() ? $_attribute->getStoreLabel() : __($_attribute->getFrontendLabel())) ?>
                                        </th>
                                    <?php endif; ?>
                                    <td class="compare__cell">
                                        <?php switch ($_attribute->getAttributeCode()) {
                                            case "price": ?>
                                                <?=
                                                    /* @noEscape */ $block->getProductPrice(
                                                        $_item,
                                                        '-compare-list-' . $_attribute->getCode()
                                                    )
                                                ?>
                                                <?php break;
                                            case "small_image": ?>
                                                <?php $block->getImage($_item, 'product_small_image')->toHtml(); ?>
                                                <?php break;
                                            default: ?>
                                                <?php if (is_string($block->getProductAttributeValue($item, $attribute))) :?>
                                                    <?= /* @noEscape */ $helper->productAttribute($item, $block->getProductAttributeValue($item, $attribute), $attribute->getAttributeCode()) ?>
                                                <?php else : ?>
                                                    <?=  $escaper->escapeHtml($helper->productAttribute($item, $block->getProductAttributeValue($item, $attribute), $attribute->getAttributeCode())) ?>
                                                <?php endif; ?>
                                                <?php break;
                                        } ?>
                                    </td>
                                <?php endforeach; ?>
                            </tr>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
    <script type="text/x-magento-init">
    {
        "[data-role=tocart-form]": {
            "catalogAddToCart": {}
        }
    }
    </script>
<?php else: ?>
    <div class="message info empty">
        <?= $escaper->escapeHtml(__('You have no items to compare.')) ?>
    </div>
<?php endif; ?>
