<?php /* @var $block \Magento\Catalog\Block\Product\View\Options\Type\Text */ ?>
<?php
$_option = $block->getOption();
$class = ($_option->getIsRequire()) ? ' required' : '';
$isTextarea = \Magento\Catalog\Api\Data\ProductCustomOptionInterface::OPTION_TYPE_AREA;
$isTextField = \Magento\Catalog\Api\Data\ProductCustomOptionInterface::OPTION_TYPE_FIELD;

$_textValidate = null;

if ($_option->getIsRequire()) {
    $_textValidate['required'] = true;
}

if ($_option->getMaxCharacters()) {
    $_textValidate['maxlength'] = $_option->getMaxCharacters();
}
?>

<div
    class="
        input
        <?php if ($_option->getType() == $isTextarea): ?>
            textarea
        <?php endif; ?>
        <?= /* @noEscape */ $class ?>
    "
>
    <label class="label" for="options_<?= $escaper->escapeHtmlAttr($_option->getId()) ?>_text">
        <?= $escaper->escapeHtml($_option->getTitle()) ?>

        <?= /* @noEscape */ $block->getFormatedPrice() ?>
    </label>

    <?php if ($_option->getType() == $isTextField): ?>
        <input
            type="text"
            id="options_<?= $_option->getId() ?>_text"
            class="input__field"
            <?php if (!empty($_textValidate)) {?>
                data-validate="<?= $escaper->escapeHtml(json_encode($_textValidate)) ?>"
            <?php } ?>
            name="options[<?= $_option->getId() ?>]"
            data-selector="options[<?= $_option->getId() ?>]"
            value="<?= $escaper->escapeHtml($block->getDefaultValue()) ?>"
        />
    <?php elseif ($_option->getType() == $isTextarea): ?>
        <textarea
            id="options_<?= $escaper->escapeHtmlAttr($_option->getId()) ?>_text"
            class="input__field input__field--textarea"
            <?php if (!empty($_textValidate)) {?>
                data-validate="<?= $escaper->escapeHtmlAttr(json_encode($_textValidate)) ?>"
            <?php } ?>
            name="options[<?= $escaper->escapeHtmlAttr($_option->getId()) ?>]"
            data-selector="options[<?= $escaper->escapeHtmlAttr($_option->getId()) ?>]"
            rows="5"
            cols="25"
        ><?= $escaper->escapeHtml($block->getDefaultValue()) ?></textarea>
    <?php endif; ?>

    <?php if ($_option->getMaxCharacters()): ?>
        <p>
            <?= $escaper->escapeHtml(__('Maximum number of characters:')) ?>
            <span class="character-counter no-display"></span>
            <strong>
                <?= $_option->getMaxCharacters() ?>
            </strong>
        </p>
    <?php endif; ?>
    <?php if ($_option->getMaxCharacters()) :?>
        <script type="text/x-magento-init">
        {
            "[data-selector='options[<?= $escaper->escapeJs($_option->getId()) ?>]']": {
                "Magento_Catalog/js/product/remaining-characters": {
                    "maxLength":  "<?= (int)$_option->getMaxCharacters() ?>",
                    "noteSelector": ".note_<?= $escaper->escapeJs($_option->getId()) ?>",
                    "counterSelector": ".note_<?= $escaper->escapeJs($_option->getId()) ?> .character-counter"
                }
            }
        }
    </script>
    <?php endif; ?>
</div>
