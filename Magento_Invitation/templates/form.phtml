<?php /** @var $block \Magento\Invitation\Block\Form */?>
<?= $block->getChildHtml('form_before') ?>

<?php $maxPerSend = $block->getMaxInvitationsPerSend(); ?>

<?php if ($maxPerSend): ?>
    <form id="invitationForm"
          action=""
          method="post"
          class="form"
          data-mage-init='{
            "rowBuilder":{
                "rowTemplate":"#add-email-friends-tmpl",
                "rowContainer":"#invitations-options",
                "rowParentElem":"<div></div>",
                "remEventSelector":"button",
                "btnRemoveSelector":".action__button.remove",
                "maxRows":"<?= $block->getMaxInvitationsPerSend(); ?>",
                "maxRowsMsg":"#max-emails-message",
                "addRowBtn":"#add-email-button",
                "additionalRowClass":"additional"
            },
            "validation":{}
          }'
          data-hasrequired="<?= $escaper->escapeHtmlAttr(__('* Required Fields')) ?>"
    >

        <input name="form_key" type="hidden" value="<?= $escaper->escapeHtml($block->getFormKeyValue()) ?>" />

        <h3 class="dashboard-form__title">
            <?= $escaper->escapeHtml(__('Invite your friends by entering their email addresses')); ?>
        </h3>

        <div id="invitations-options"></div>

        <?php if ($block->isInvitationMessageAllowed()): ?>
            <div id="max-emails-message" style="display: none;" class="message notice limit" role="alert">
                <?= $escaper->escapeHtml(__('Maximum %1 email addresses allowed.', $block->getMaxInvitationsPerSend())) ?>
            </div>
        <?php endif; ?>

        <div class="action dashboard-form__divider">
            <div class="action__handler">
                <?php if (1 < $block->getMaxInvitationsPerSend()): ?>
                    <button type="button" id="add-email-button" class="button action__button add">
                        <?= $escaper->escapeHtml(__('Add')) ?>
                    </button>
                <?php endif; ?>
            </div>
        </div>

        <?php if ($block->isInvitationMessageAllowed()): ?>
            <div class="input text">
                <label for="message" class="label">
                    <?= $escaper->escapeHtml(__('Message')); ?>
                </label>

                <textarea name="message"
                          id="message"
                          title="<?= $escaper->escapeHtmlAttr(__('Message')) ?>"
                          placeholder="<?= $escaper->escapeHtmlAttr(__('Message')) ?>"
                          class="input__field input__field--textarea"
                          rows="5"
                          cols="5"
                ></textarea>
            </div>
        <?php endif;?>

        <div class="action">
            <?php
                $getCustomerInvitationUrl = $this->helper('Magento\Invitation\Helper\Data')
                                                 ->getCustomerInvitationUrl();
            ?>

            <div class="action__handler">
                <button class="button action__button" type="submit">
                    <?= $escaper->escapeHtml(__('Send Invitations')) ?>
                </button>
            </div>

            <div class="action__handler">
                <a href="<?= $escaper->escapeUrl($getCustomerInvitationUrl) ?>"
                   class="link action__link back"
                >
                   <?= $escaper->escapeHtml(__('Back to Invitations')) ?>
                </a>
            </div>
        </div>
    </form>

    <script id="add-email-friends-tmpl" type="text/x-magento-template">
        <div class="input required">
            <label for="email_<%- data._index_ %>" class="label">
                <?= $escaper->escapeHtml(__('Email')) ?>
            </label>

            <input name="email[<%- data._index_ %>]"
                   id="email_<%- data._index_ %>"
                   title="<?= $escaper->escapeHtmlAttr(__('Email')) ?>"
                   value=""
                   class="input__field "
                   type="email"
                   data-validate="{required:true, 'validate-email':true}"
                   placeholder="<?= $escaper->escapeHtmlAttr(__('Enter Email')) ?>"
            />
        </div>

        <div class="action">
            <div class="action__handler">
                <button type="button"
                        id="btn-remove<%- data._index_ %>"
                        class="button action__button remove"
                        title="<?= $escaper->escapeJsQuote(__('Remove')) ?>"
                >
                    <?= $escaper->escapeJsQuote(__('Remove')) ?>
                </button>
            </div>
        </div>
    </script>
<?php else:?>
    <div class="message info empty">
        <?= $escaper->escapeHtml(__('You cannot send more invitations')); ?>
    </div>

    <?php
        $getCustomerInvitationUrl = $this->helper('Magento\Invitation\Helper\Data')
                                         ->getCustomerInvitationUrl();
    ?>

    <div class="action">
        <div class="action__handler">
            <a href="<?= $getCustomerInvitationUrl ?>"
               class="link action__link"
            >
                <?= $escaper->escapeHtml(__('Back to Invitations')) ?>
            </a>
        </div>
    </div>
<?php endif; ?>
